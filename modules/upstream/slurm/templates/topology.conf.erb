# -*- mode: conf; -*-
###################################################################################
# topology.conf -- Slurm's network topology for the '<%= scope['slurm::clustername'] %>' cluster
# for use with the 'topology/<%= scope['slurm::topology'] %>' plugin
#
###################################################################################
# Documentation: https://slurm.schedmd.com/topology.conf.html
#
# Note: the topology.conf file for an Infiniband switch can be automatically
# generated using the slurmibtopology tool found here:
#       https://ftp.fysik.dtu.dk/Slurm/slurmibtopology.sh
#
# Use also 'ibnetdiscover -S [-p]' to feed/check this file.
###################################################################################
# /!\ DO NOT EDIT THIS FILE: It has been automatically generated by Puppet.
#  In particular, any further changes will be overwritten at the next puppet
#  invocation
###################################################################################
#
<% scope['slurm::topology_tree'].each do |switchname, c| -%>
<%    child = [] -%>
<%    c.each do |k,v| -%>
<%       if k == 'comment' -%>
# <%= v %>
<%       else -%>
<%          child << "#{k == 'linkspeed' ? 'LinkSpeed' : k.capitalize}=#{v}" -%>
<%       end -%>
<%    end -%>
SwitchName=<%= switchname %> <%= child.join(' ') %>
<% end -%>
